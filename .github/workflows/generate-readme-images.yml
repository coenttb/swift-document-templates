name: Generate README Images

on:
  push:
    branches:
      - main
    paths:
      - '.github/Images/*.pdf'
  workflow_dispatch:

jobs:
  convert-pdfs:
    name: Convert PDFs to PNGs for README
    runs-on: macos-latest

    steps:
      - uses: actions/checkout@v6

      - name: Convert PDFs to PNGs using sips
        run: |
          cd .github/Images
          for pdf in *.pdf; do
            png="${pdf%.pdf}.png"
            echo "Converting $pdf to $png..."
            # Use macOS built-in sips tool - no dependencies needed
            sips -s format png "$pdf" --out "$png" 2>&1 | grep -v "Warning"
          done
          ls -lh *.png

      - name: Commit and push PNGs
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add .github/Images/*.png
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m "chore: regenerate README PNG images from PDFs [skip ci]"
            git push
          fi
